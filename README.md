# Шаблон проекта ШИФТ Интенсив
Шаблон на основе которого можно начинать проект

## Технологии/зависимости
### Java
В рамках проекта используется Java версией 17. 
Скачать можно по ссылке https://bell-sw.com/pages/downloads/#downloads

### Среда разработки
Мы используем Jetbrains IDEA и вам советуем. Доступна тут https://www.jetbrains.com/idea/download/

Community Edition будет достаточно

### Gradle
Сборка проекта осуществляется с помощью Gradle версией 7. 

Получить Gradle можно двумя способами:
1. С помощью Gradle Wrapper из шаблона проекта (предпочтительный вариант). Для этого из каталога с проектом в консоле нужно выполнить команду
```console
gradlew
```
2. Скачать по ссылке https://gradle.org/next-steps/?version=7.6&format=bin

### База данных
В шаблоне проекта в качестве примера используется PostgreSQL. 
По сути можно использовать любую другую РСУБД, предварительно предупредив нас об этом.
Запустить PostgreSQL можно двумя способами:

1. С помощью Docker (предпочтительный вариант). 
   1. Скачать и установить Docker по ссылке https://www.docker.com/products/docker-desktop/
   2. Запустить Docker Desktop
   3. Выполнить команду в консоле из директории проекта
   ```console
   docker-compose up -d
   ```
   Запустятся 2 контейнера: postgres (доступен по jdbc:postgresql://localhost:5432/postgres) и pgadmin (http://localhost:5050/)

2. Скачать по ссылке https://www.postgresql.org/download/. Установить и запустить

### Подключение к БД через PgAdmin (Docker)
Если PostgreSQL запущен с помощью Docker и есть желание посмотреть структуру БД с помощью PgAdmin, то сначала нужно определить host БД в Docker.
Для этого:

1. В консоле выполняем команду
   ```console
   docker ps
   ```
   Появится табличка типа (столбец CONTAINER ID будет отличаться)

   | CONTAINER ID | IMAGE          | ... |... |
   |--------------|----------------|-----|----|
   | d2cbe44db0c3 | postgres:13    | ... |... |
   | d67676e6ced3 | dpage/pgadmin4 | ... |... |

2. В консоле выполнить команду для получения IP адреса (d2cbe44db0c3 берется из колонки CONTAINER ID напротив postgres:13)
   ```console
   docker inspect d2cbe44db0c3 | grep IPAddress
   ```
   Ответ будет что-то типа такого (IPAddress может отличаться)
   ```console
   "SecondaryIPAddresses": null,
   "IPAddress": "",
               "IPAddress": "172.24.0.2",
   ```

3. Через браузер идем на http://localhost:5050/
4. В поле логин / пароль вводим admin@admin.com / root
5. Слева появится дерево с каталогом Servers. Правой кнопкой на Servers -> Register -> Server...
6. Вкладка General поле Name введите Postgres
7. Вкладка Connection поле Host name/address введите значение из предыдущей команды (172.24.0.2)
8. Вкладка Connection поле Username - postgres
9. Вкладка Connection поле Password - postgres
10. Жмем Save

### Flyway
Для автоматического наката скриптов на БД используется библиотека Flyway. 
Все скрипты наката хранятся в каталоге ``src/main/resources/db/migration``. 
Накатываться новые скрипты будут при запуске приложения.

Наименование скриптов соответствует паттерну наименования (flyway naming pattern).
Рассмотрим на пример файла инициализации ``V1_0__init_schema.sql``. 
Разбить его можно на следующие части:

1. V - префикс
2. 1_0 - версия
3. __ - разделитель версии и описания (2 нижних подчеркивания)
4. init_schema - описание файла
5. .sql - постфикс

Например, мы хотим добавить следующий файл, который будет создавать табличку с заказами. 
Согласно паттерну назвать можно следующим образом: ``V1_1__creating_order_table.sql``, где:

1. V - префикс
2. 1_1 - версия
3. __ - разделитель версии и описания (2 нижних подчеркивания)
4. creating_order_table - описание того, что делает файл
5. .sql - постфикс

Подробную информацию можно почитать тут https://flywaydb.org/documentation/concepts/migrations.html#naming

Важно! Редактировать файлы после наката на БД (запуска приложения) нельзя! 
Если накатили скрипт и хотите отменить, то создавайте новый скрипт и там пишите изменения для отката.

### Структура проекта
1. Класс ``ru.cft.shift.intensive.sample.Application`` - точка входа в приложение. Запуск приложения будет осуществляться с помощью метода ``main``
2. Пакет ``ru.cft.shift.intensive.template.configuration`` - здесь хранятся все конфигурации
3. Пакет ``ru.cft.shift.intensive.template.controller`` - паке с классами API
4. Пакет ``ru.cft.shift.intensive.template.dto`` - объекты, необходимые для взаимодействия через API
5. Пакет ``ru.cft.shift.intensive.template.exception`` - кастомные исключения
6. Пакет ``ru.cft.shift.intensive.template.exception`` - классы для взаимодействия с БД
7. Пакет ``ru.cft.shift.intensive.template.serive`` - классы с бизнес-логикой (по сути связь API и БД)

## Общие требования к проекту
### Технические
1. Использование Java 17
2. Использование Spring Boot 2
3. Использование системы автоматической сборки Gradle
4. Использование фреймворка логирования (желательно Logback)
5. Наличие README, в котором описан проект, как его запустить, функциональность этого проекта и, если это необходимо, тестовые данные для запуска
6. Наличие скриптов миграции для БД или, если не используется Flyway, приложен скрипт создания БД
7. Наличие коллекции запросов для Postman для проверки API
### Проектные
1. Приложение запускается и реализован функционал задачи
2. Перед реализацией задачи сделано и согласовано API с куратором в текстовом виде
3. Код задачи в репозитории в отдельной ветке, по возможности создан PR в мастер
4. Код чистый (нет мусорных/тестовых методов, закомментированного кода, используются читаемые и понятные имена переменных, соблюдается Java Naming Convention, есть декомпозиция, соблюдение принципа SOLID)
5. Регистрация и авторизация пользователей по логину/ФИО/email и т.д.. Допускается:
   1. Отсутствие пароля (авторизация/аутентификация только по логину)
   2. Хранение логина и пароля (если имеется) в незашифрованном виде
6. Личный кабинет пользователя (добавление/редактирование данных пользователя)
7. Валидация всех входных данных API (например, нельзя вставить строковое значение в числовое поле, проверка обязательности полей, проверка на количество символов и т.д;)

## Дополнительные общие требования (улучшения)
### Технические
1. Использование Docker
2. Использование Flyway
### Проектные
1. Авторизация с помощью Spring Security. Данные пользователя (логин и пароль) хранятся в зашифрованном виде

## Задания
### Планировщик
Реализовать сервис для создания событий, напоминаний в календаре
#### Требования
1. Создание события в календаре. На 1 час может быть только 1 событие
2. Удаление события из календаря
3. Редактирование событий в календаре (наименование события, описание, время и т.д.)
4. Просмотр всех событий пользователя (прошедших, предстоящих) за определенный период времени с сортировкой по дате
5. Просмотр ближайших актуальных событий
6. Делиться событиями с другими пользователями (доступ на просмотр). Проверка наличия событий на заданное время у пользователя, с которым делишься событием (время должно быть свободно)
#### Разбиение по правам доступа к событиям
1. Просматривать можно свои события + события, которыми поделились другие пользователи
2. Редактировать можно только свои события
#### Дополнительные требования (улучшения)
1. Настраиваемые уведомления о предстоящем событии (можно реализовать через API, можно через email)
2. Важность/критичность события (разбиение API на уровни важности + уведомления)
3. Дополнительное право доступа. Редактировать можно свои события и события, которыми поделились другие пользователи (например предложить перенести время события)
### Файловое хранилище
Реализовать сервис, который позволит управлять файлами (добавлять, удалять, делиться)
#### Требования
1. Создание каталогов
2. Удаление каталогов
3. Редактирование наименования у каталога
4. Загрузка файлов в каталоги
5. Удаление файлов из каталогов
6. Скачивание файлов из каталога
7. Возможность делиться файлами/каталогами с другими пользователями по уникальной ссылке (для всех, для групп пользователей)
8. Хранение файлов либо на файловой системе с метаданными в БД, либо в S3 хранилище (хранение файлов в БД не допускается)
9. Поиск файлов/каталогов по имени, сортировка файлов в каталоге
#### Разбиение по правам доступа к файлам/каталогам
1. Просматривать можно свои файлы/каталоги + файлы/каталоги, которыми поделились другие пользователи
#### Дополнительные требования (улучшения)
1. Выгрузка каталогов с файлами (архивирование и сжатие)
2. Добавление тэгов для файлов/каталогов. Быстрый поиск по тэгам
3. Временные файлы/каталоги. Удаление файлов/каталогов через определенный промежуток времени
4. Добавить возможность загружать медиа файлы и стриминг их
### Магазин бытовой техники и электроники
Реализовать сервис для покупки/продажи бытовой техники и электроники
#### Разбиение по ролям
1. Продавец
2. Покупатель
#### Требования к роли продавец
1. Создание товара с указанием наличия (количества штук), даты поступления (если товар отсутствует в данные момент), отсутствия
2. Добавление/редактирования товаров (описание, наличие, дата доставки)
3. Загрузка фотографий товара (хранить фото можно в БД либо на файловой системе)
4. История продаж товаров (успешных)
5. Подготовка товара к выдаче (после того, как товар оплачен, нужно подтвердить о готовности выдать товар)
6. Выдача товара (после выдачи покупку считаем успешной. Выдача товара происходит простой сменой статуса заказа)
#### Требования к роли покупатель
1. Просмотр списка товаров
2. Просмотр полной информации о конкретном товаре
3. Поиск (фильтрация) товаров по параметрам (тип товара, цена, модель, год, наличие и т.д.)
4. Добавление товар в корзину (добавлять можно товар, который есть в наличии, либо скоро поступит)
5. Бронирование товара (бронировать можно товар, который в корзине и есть в наличии)
6. Оплата товара (оплачивать товар можно только после бронирования. Оплата происходит простой сменой статуса заказа)
7. История покупок (успешных)
#### Дополнительные требования (улучшения) для роли продавец
1. Хранение фотографий  товаров либо на файловом хранилище либо в S3 хранилище (БД не допускается)
2. Уведомление  о смене статуса заказа (бронь, оплата, выдано) через API, либо на email
3. Разделение уведомлений на новые и на историю
4. Уведомления идентификатора для оплаты/выдачи товара. Например продавец не может поменять статус на «Выдано», пока не введет код от покупателя, который ему пришел в уведомлении после оплаты.
#### Дополнительные требования (улучшения) для роли покупатель
1. Уведомление  о смене статуса товара/заказа (поступление, бронь, оплата, готов к выдачи, выдано) через API, либо на email
2. Разделение уведомлений на новые и на историю
3. Оплата заказа по идентификатору. После бронирования заказа покупателю приходит уведомление с идентификатором, который нужно будет вести перед оплатой